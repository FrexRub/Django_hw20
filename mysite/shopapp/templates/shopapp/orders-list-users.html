{% extends 'shopapp/base.html' %}
{% load cache %}

{% block title %}
  Orders list
{% endblock %}

{% block body %}
    Time running: {% now "u" %}
  {% if object_list %}
  <div>
      <h1>Пользователь {{ username }} выполнил следующие заказы:</h1>
  </div>
  {% cache 20 orders user_id%}
    <div>
      Time running(cache): {% now "u" %}
      {% for order in object_list %}
        <div>
          <p><a href="{% url 'shopapp:order_details' pk=order.pk %}"
          >Details #{{ order.pk }}</a></p>
          <p>Order by {% firstof order.user.first_name order.user.username %}</p>
          <p>Promocode: <code>{{ order.promocode }}</code></p>
          <p>Delivery address: {{ order.delivery_address }}</p>
          <div>
            Product in order:
            <ul>
              {% for product in order.products.all %}
                <li>{{ product.name }} for ${{ product.price }}</li>
              {% endfor %}

            </ul>
          </div>

        </div>
      {% endfor %}

    </div>
  {% endcache %}
  <div>
    <a href="{% url 'shopapp:user_orders_export' user_id=user_id%}">Export orders to the file</a>
  </div>
  {% else %}
    <h3>У пользователя {{ username }} ещё нет заказов</h3>
  {% endif %}
  <div></div>

  <div>
    <a href="{% url 'shopapp:orders_create' %}"> Create order</a>
  </div>
  <div>
    <a href="{% url 'shopapp:index' %}">Back to index shop list</a>
  </div>
{% endblock %}
